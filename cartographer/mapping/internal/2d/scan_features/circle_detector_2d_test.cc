#include "cartographer/mapping/internal/2d/scan_features/circle_detector_2d.h"

#include "cartographer/mapping/internal/2d/scan_matching/ceres_scan_matcher_2d.h"

#include "cartographer/common/lua_parameter_dictionary.h"
#include "cartographer/common/lua_parameter_dictionary_test_helpers.h"
#include "cartographer/common/math.h"
#include "gmock/gmock.h"
#include "gtest/gtest.h"

#include "cartographer/mapping/internal/2d/scan_matching/ray_trace.h"

#include <random>
#include <vector>

#include "cartographer/common/time.h"
#include "cartographer/mapping/2d/submap_2d.h"

namespace cartographer {
namespace mapping {
namespace {

TEST(CirclDetector, real_data) {
  // std::vector<double> ranges = {0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 1.149999976158142, 1.149999976158142, 1.149999976158142, 1.1399999856948853,
  // 1.159999966621399, 1.159999966621399, 1.159999966621399, 1.1799999475479126,
  // 1.1399999856948853, 1.1699999570846558, 1.159999966621399, 1.1799999475479126,
  // 1.190000057220459, 1.2200000286102295, 1.25, 1.409999966621399, 1.5499999523162842,
  // 1.5399999618530273, 1.559999942779541, 1.5299999713897705, 1.5199999809265137,
  // 1.5099999904632568, 1.5, 1.2599999904632568, 1.059999942779541, 1.0299999713897705,
  // 1.0299999713897705, 1.0399999618530273, 1.0399999618530273, 1.059999942779541,
  // 1.2999999523162842, 1.4600000381469727, 1.4600000381469727, 1.4700000286102295,
  // 1.4500000476837158, 1.4600000381469727, 1.4500000476837158, 1.440000057220459,
  // 1.440000057220459, 1.440000057220459, 1.4299999475479126, 1.4199999570846558,
  // 1.4299999475479126, 1.409999966621399, 1.4199999570846558, 1.399999976158142,
  // 1.3899999856948853, 1.3899999856948853, 1.399999976158142, 1.3899999856948853,
  // 1.3799999952316284, 1.3799999952316284, 1.3899999856948853, 1.3799999952316284,
  // 1.3700000047683716, 1.3700000047683716, 1.1100000143051147,
  // 0.7599999904632568, 0.7300000190734863, 0.7200000286102295,
  // 0.699999988079071, 0.699999988079071, 0.6800000071525574,
  // 0.6800000071525574, 0.6899999976158142, 0.6700000166893005,
  // 0.6800000071525574, 0.6700000166893005, 0.6600000262260437,
  // 0.6600000262260437, 0.6700000166893005, 0.6700000166893005,
  // 0.6499999761581421, 0.6600000262260437, 0.6700000166893005,
  // 0.6499999761581421, 0.6600000262260437, 0.6499999761581421,
  // 0.6600000262260437, 0.6600000262260437, 0.6499999761581421,
  // 0.6499999761581421, 0.6600000262260437, 0.6499999761581421,
  // 0.6499999761581421, 0.6700000166893005, 0.6600000262260437,
  // 0.6600000262260437, 0.6600000262260437, 0.6600000262260437,
  // 0.6700000166893005, 0.6600000262260437, 0.6499999761581421,
  // 0.6700000166893005, 0.6499999761581421, 0.6499999761581421,
  // 0.6600000262260437, 0.6600000262260437, 0.6499999761581421,
  // 0.6600000262260437, 0.6600000262260437, 0.6499999761581421,
  // 0.6800000071525574, 0.6800000071525574, 0.6800000071525574,
  // 0.6600000262260437, 0.6800000071525574, 0.6800000071525574,
  // 0.6899999976158142, 0.6800000071525574, 0.6800000071525574,
  // 0.6899999976158142, 0.699999988079071, 0.699999988079071,
  // 0.699999988079071, 0.7099999785423279, 0.7099999785423279,
  // 0.7200000286102295, 0.7200000286102295, 0.7400000095367432,
  // 0.7400000095367432,
  // 0.7799999713897705, 1.1699999570846558, 1.409999966621399, 1.4299999475479126,
  // 1.4299999475479126, 1.440000057220459, 1.4500000476837158, 1.4500000476837158,
  // 1.4500000476837158, 1.4600000381469727, 1.4700000286102295, 1.4700000286102295,
  // 1.4800000190734863, 1.4900000095367432, 1.4800000190734863, 1.5, 1.5, 1.5099999904632568,
  // 1.5099999904632568, 1.5299999713897705, 1.5299999713897705, 1.5399999618530273,
  // 1.559999942779541, 1.5499999523162842, 1.5700000524520874, 1.5800000429153442,
  // 1.5800000429153442, 1.590000033378601, 1.600000023841858, 1.6200000047683716,
  // 1.6299999952316284, 1.6399999856948853, 1.6399999856948853, 1.649999976158142,
  // 1.6699999570846558, 1.690000057220459, 1.6799999475479126, 1.7000000476837158,
  // 1.7100000381469727, 1.7100000381469727, 1.7300000190734863, 1.75, 1.7699999809265137,
  // 1.7699999809265137, 1.7899999618530273, 1.7899999618530273, 1.8300000429153442,
  // 1.840000033378601, 1.850000023841858, 1.8600000143051147, 1.7699999809265137,
  // 1.7400000095367432, 1.5700000524520874, 1.5, 1.4900000095367432, 1.5, 1.5299999713897705,
  // 1.7599999904632568, 2.0199999809265137, 2.059999942779541, 2.0899999141693115,
  // 2.0999999046325684, 2.119999885559082, 2.1500000953674316, 2.1600000858306885,
  // 2.190000057220459, 2.2200000286102295, 2.240000009536743, 2.259999990463257,
  // 2.2899999618530273, 2.319999933242798, 2.369999885559082, 2.380000114440918,
  // 2.4200000762939453, 2.450000047683716, 2.4700000286102295, 2.509999990463257,
  // 2.5399999618530273, 2.5899999141693115, 2.609999895095825, 2.6600000858306885,
  // 2.700000047683716, 2.7300000190734863, 1.409999966621399, 1.2300000190734863,
  // 1.2100000381469727, 1.2100000381469727, 1.2000000476837158, 1.2000000476837158,
  // 1.2000000476837158, 1.190000057220459, 1.190000057220459, 1.2100000381469727,
  // 1.2100000381469727, 1.2400000095367432, 3.4800000190734863, 3.549999952316284,
  // 1.3200000524520874, 1.2799999713897705, 1.2699999809265137, 1.2400000095367432,
  // 1.25, 1.25, 1.25, 1.2599999904632568, 1.2799999713897705, 1.2699999809265137,
  // 1.2899999618530273, 6.170000076293945, 6.159999847412109, 6.139999866485596,
  // 6.130000114440918, 6.119999885559082, 6.099999904632568, 6.090000152587891, 6.070000171661377,
  // 6.059999942779541, 6.050000190734863, 1.75, 1.7200000286102295, 1.7000000476837158,
  // 1.7000000476837158, 1.690000057220459, 1.690000057220459, 1.7000000476837158,
  // 1.7300000190734863, 1.7300000190734863, 5.96999979019165, 5.960000038146973,
  // 3.440000057220459, 3.4200000762939453, 3.4000000953674316, 3.4000000953674316,
  // 3.4200000762939453, 3.4600000381469727, 5.849999904632568, 5.849999904632568,
  // 5.840000152587891, 5.829999923706055, 5.829999923706055, 5.829999923706055, 5.829999923706055,
  // 5.820000171661377, 5.829999923706055, 5.829999923706055, 5.820000171661377, 5.809999942779541,
  // 5.809999942779541, 5.820000171661377, 5.820000171661377, 5.809999942779541, 5.829999923706055,
  // 5.829999923706055, 5.829999923706055, 5.840000152587891, 5.849999904632568, 5.860000133514404,
  // 5.860000133514404, 5.869999885559082, 5.880000114440918, 5.889999866485596, 5.900000095367432,
  // 5.900000095367432, 3.0399999618530273, 2.990000009536743, 2.9800000190734863,
  // 2.9600000381469727, 2.9800000190734863, 2.990000009536743, 2.9700000286102295,
  // 3.0, 3.4700000286102295, 4.78000020980835, 4.409999847412109, 4.420000076293945,
  // 4.429999828338623, 29.959999084472656, 29.959999084472656, 29.959999084472656,
  // 6.190000057220459, 6.21999979019165, 29.959999084472656, 29.959999084472656,
  // 4.559999942779541, 29.959999084472656, 29.959999084472656, 4.590000152587891,
  // 4.610000133514404, 4.599999904632568, 4.619999885559082, 6.199999809265137, 6.199999809265137,
  // 6.210000038146973, 6.559999942779541, 6.610000133514404, 6.630000114440918, 2.6700000762939453,
  // 2.630000114440918, 2.5999999046325684, 2.5999999046325684, 2.559999942779541,
  // 2.569999933242798, 2.5899999141693115, 2.5999999046325684, 6.909999847412109,
  // 6.949999809265137, 6.920000076293945, 6.639999866485596, 6.619999885559082, 6.420000076293945,
  // 6.420000076293945, 6.570000171661377, 6.630000114440918, 6.789999961853027, 3.819999933242798,
  // 3.759999990463257, 3.7300000190734863, 3.7200000286102295, 3.7200000286102295,
  // 3.7300000190734863, 3.759999990463257, 3.740000009536743, 7.059999942779541,
  // 3.25, 3.190000057220459, 3.1700000762939453, 3.130000114440918, 3.109999895095825,
  // 3.0899999141693115, 3.0899999141693115, 3.130000114440918, 3.130000114440918,
  // 8.399999618530273, 8.5, 8.569999694824219, 8.649999618530273, 8.729999542236328,
  // 8.800000190734863, 8.859999656677246, 8.930000305175781, 9.020000457763672, 9.09000015258789,
  // 8.970000267028809, 4.960000038146973, 4.929999828338623, 4.880000114440918, 4.849999904632568,
  // 4.809999942779541, 4.78000020980835, 4.739999771118164, 4.71999979019165, 4.730000019073486,
  // 4.75, 4.800000190734863, 4.849999904632568, 4.900000095367432, 4.789999961853027,
  // 4.840000152587891, 4.78000020980835, 4.760000228881836, 5.489999771118164, 8.359999656677246,
  // 5.190000057220459, 5.179999828338623, 8.859999656677246, 12.430000305175781,
  // 12.319999694824219, 12.319999694824219, 13.199999809265137, 13.100000381469727,
  // 13.15999984741211, 13.149999618530273, 14.09000015258789, 7.800000190734863,
  // 7.78000020980835, 7.78000020980835, 7.820000171661377, 8.579999923706055, 8.630000114440918,
  // 8.100000381469727, 7.75, 7.800000190734863, 8.140000343322754, 7.829999923706055,
  // 7.78000020980835, 8.300000190734863, 8.430000305175781, 29.959999084472656, 15.15999984741211,
  // 15.09000015258789, 15.0, 15.010000228881836, 7.909999847412109, 7.900000095367432,
  // 7.980000019073486, 8.369999885559082, 8.59000015258789, 14.859999656677246, 14.84000015258789,
  // 14.8100004196167, 14.75, 14.760000228881836, 8.949999809265137, 8.920000076293945,
  // 14.6899995803833, 14.680000305175781, 14.670000076293945, 14.630000114440918,
  // 14.619999885559082, 29.959999084472656, 7.599999904632568, 7.559999942779541,
  // 7.570000171661377, 7.670000076293945, 7.730000019073486, 8.510000228881836, 7.639999866485596,
  // 7.619999885559082, 7.599999904632568, 7.610000133514404, 13.960000038146973,
  // 14.0600004196167, 14.180000305175781, 14.3100004196167, 14.34000015258789, 14.350000381469727,
  // 14.359999656677246, 14.34000015258789, 14.300000190734863, 14.1899995803833,
  // 14.600000381469727, 14.59000015258789, 14.600000381469727, 14.59000015258789,
  // 14.609999656677246, 14.609999656677246, 14.640000343322754, 14.229999542236328,
  // 14.210000038146973, 14.239999771118164, 14.260000228881836, 14.460000038146973,
  // 14.770000457763672, 14.789999961853027, 14.829999923706055, 14.84000015258789,
  // 14.890000343322754, 4.53000020980835, 4.25, 4.090000152587891, 4.090000152587891,
  // 4.050000190734863, 4.050000190734863, 15.069999694824219, 15.140000343322754,
  // 29.959999084472656, 3.700000047683716, 3.549999952316284, 3.5299999713897705,
  // 3.5299999713897705, 3.509999990463257, 3.5199999809265137, 3.5199999809265137,
  // 3.5199999809265137, 3.5199999809265137, 3.130000114440918, 2.930000066757202,
  // 2.930000066757202, 3.059999942779541, 3.569999933242798, 3.609999895095825, 16.040000915527344,
  // 16.100000381469727, 8.279999732971191, 8.359999656677246, 9.300000190734863,
  // 9.380000114440918, 9.210000038146973, 8.789999961853027, 8.779999732971191, 29.959999084472656,
  // 14.300000190734863, 14.140000343322754, 8.989999771118164, 8.960000038146973,
  // 13.510000228881836, 13.3100004196167, 13.130000114440918, 12.970000267028809,
  // 2.680000066757202, 2.680000066757202, 2.6500000953674316, 2.630000114440918,
  // 2.640000104904175, 2.6700000762939453, 2.6700000762939453, 2.680000066757202,
  // 2.700000047683716, 2.700000047683716, 2.75, 2.7699999809265137, 10.960000038146973,
  // 10.890000343322754, 10.75, 10.670000076293945, 10.569999694824219, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0}; std::vector<double> intensities= {0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 8192.0, 8192.0, 8192.0, 8192.0, 8192.0,
  // 8192.0, 0.0, 0.0, 0.0, 0.0, 8192.0, 8192.0, 8192.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 8192.0, 8192.0, 8192.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 8192.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 8192.0, 0.0, 0.0, 0.0, 0.0, 0.0, 8192.0,
  // 8192.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0};

  // std::vector<double> ranges = {0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 1.2999999523162842, 1.3300000429153442, 1.3300000429153442, 1.350000023841858,
  // 1.3700000047683716, 1.3899999856948853, 1.4199999570846558, 1.4199999570846558,
  // 1.1299999952316284, 1.0299999713897705, 1.0, 0.9900000095367432,
  // 0.9700000286102295, 0.949999988079071, 0.9399999976158142,
  // 0.949999988079071, 0.9200000166893005, 0.9300000071525574,
  // 0.9300000071525574, 0.9200000166893005, 0.9300000071525574,
  // 0.9200000166893005, 0.9200000166893005, 0.9200000166893005,
  // 0.9200000166893005, 0.9399999976158142, 0.9399999976158142,
  // 0.9300000071525574, 0.9300000071525574, 0.9300000071525574,
  // 0.9399999976158142, 0.9399999976158142, 0.9399999976158142,
  // 0.949999988079071, 0.949999988079071, 0.9599999785423279,
  // 0.9599999785423279, 0.9700000286102295, 0.9800000190734863,
  // 0.9800000190734863, 0.9900000095367432, 1.0,
  // 0.9900000095367432, 1.0199999809265137, 1.0199999809265137, 1.0499999523162842,
  // 1.0800000429153442, 1.25, 1.3799999952316284, 1.3600000143051147, 1.3600000143051147,
  // 1.3600000143051147, 1.3700000047683716, 1.3600000143051147, 1.3600000143051147,
  // 1.350000023841858, 1.350000023841858, 1.350000023841858, 1.3300000429153442,
  // 1.340000033378601, 1.3300000429153442, 1.3300000429153442, 1.3300000429153442,
  // 1.309999942779541, 1.1200000047683716, 0.9200000166893005,
  // 0.9200000166893005, 0.9100000262260437, 0.9100000262260437,
  // 0.9200000166893005,
  // 0.9200000166893005, 1.0499999523162842, 1.2100000381469727, 1.3200000524520874,
  // 1.2799999713897705, 1.309999942779541, 1.2899999618530273, 1.2799999713897705,
  // 1.309999942779541, 1.309999942779541, 1.2999999523162842, 1.2999999523162842,
  // 1.2999999523162842, 1.3200000524520874, 1.2799999713897705, 1.2899999618530273,
  // 1.2999999523162842, 1.309999942779541, 1.2999999523162842, 1.2999999523162842,
  // 1.309999942779541, 1.309999942779541, 1.2999999523162842, 1.309999942779541,
  // 1.2999999523162842, 1.2899999618530273, 1.309999942779541, 1.2999999523162842,
  // 1.2899999618530273, 1.309999942779541, 1.309999942779541, 1.2999999523162842,
  // 1.3200000524520874, 1.309999942779541, 1.3200000524520874, 1.1699999570846558,
  // 1.0199999809265137, 0.9599999785423279, 0.8999999761581421,
  // 0.8799999952316284, 0.8399999737739563, 0.8299999833106995,
  // 0.8100000023841858, 0.7799999713897705, 0.7699999809265137, 0.75,
  // 0.7400000095367432, 0.7400000095367432, 0.7400000095367432,
  // 0.7300000190734863, 0.7300000190734863, 0.7300000190734863,
  // 0.7300000190734863, 0.7200000286102295, 0.7200000286102295,
  // 0.7200000286102295, 0.6899999976158142, 0.7300000190734863,
  // 0.7200000286102295, 0.7099999785423279, 0.7200000286102295,
  // 0.7300000190734863, 0.7200000286102295, 0.7200000286102295,
  // 0.7300000190734863, 0.7300000190734863, 0.75, 0.7400000095367432,
  // 0.7400000095367432, 0.7300000190734863, 0.75, 0.7599999904632568, 0.75,
  // 0.75, 0.7699999809265137, 0.7599999904632568, 0.7699999809265137,
  // 0.7699999809265137, 0.7799999713897705, 0.7799999713897705,
  // 0.7799999713897705, 0.7900000214576721, 0.7900000214576721,
  // 0.800000011920929, 0.800000011920929, 0.8100000023841858,
  // 0.8100000023841858, 0.8199999928474426, 0.8299999833106995,
  // 0.8199999928474426, 0.8399999737739563, 0.8500000238418579,
  // 0.8500000238418579, 0.8700000047683716, 0.8700000047683716,
  // 0.8700000047683716, 0.8799999952316284, 0.9100000262260437,
  // 0.9700000286102295, 1.7999999523162842, 1.8300000429153442, 1.7300000190734863,
  // 1.4800000190734863, 1.4700000286102295, 1.4600000381469727, 1.4700000286102295,
  // 1.6399999856948853, 1.9199999570846558, 1.9700000286102295, 1.9900000095367432,
  // 2.0, 2.0399999618530273, 2.049999952316284, 2.069999933242798, 2.0899999141693115,
  // 2.119999885559082, 2.140000104904175, 1.940000057220459, 1.559999942779541, 1.649999976158142,
  // 2.240000009536743, 2.2699999809265137, 2.2799999713897705, 2.3299999237060547,
  // 2.3499999046325684, 2.4000000953674316, 2.4200000762939453, 2.4700000286102295,
  // 2.4800000190734863, 2.5299999713897705, 2.569999933242798, 2.5999999046325684,
  // 2.619999885559082, 2.680000066757202, 2.7100000381469727, 2.759999990463257,
  // 0.36000001430511475, 0.3499999940395355, 0.3499999940395355,
  // 0.36000001430511475, 0.3499999940395355, 0.3499999940395355,
  // 0.3400000035762787, 0.3400000035762787, 0.33000001311302185,
  // 0.33000001311302185, 0.3199999928474426, 0.33000001311302185,
  // 0.3100000023841858, 0.33000001311302185, 0.3199999928474426,
  // 0.3199999928474426, 0.33000001311302185, 0.3199999928474426,
  // 0.33000001311302185, 0.3199999928474426, 0.3199999928474426,
  // 0.3199999928474426, 0.3199999928474426, 0.3100000023841858,
  // 0.3199999928474426, 0.3100000023841858, 0.3100000023841858,
  // 0.3100000023841858, 0.3100000023841858, 0.3199999928474426,
  // 0.3199999928474426, 0.33000001311302185, 0.3199999928474426,
  // 0.33000001311302185, 0.3499999940395355, 0.3799999952316284,
  // 0.38999998569488525, 0.38999998569488525, 0.38999998569488525,
  // 0.38999998569488525, 0.3799999952316284, 0.3700000047683716,
  // 0.3700000047683716, 0.3700000047683716, 0.3799999952316284,
  // 0.3700000047683716, 0.36000001430511475, 0.3799999952316284,
  // 0.36000001430511475, 0.3700000047683716, 0.36000001430511475,
  // 0.3700000047683716, 0.36000001430511475, 0.3700000047683716,
  // 0.3700000047683716, 0.3700000047683716, 0.36000001430511475,
  // 0.3700000047683716, 0.3799999952316284, 0.3700000047683716,
  // 0.3700000047683716, 0.3799999952316284, 0.3799999952316284,
  // 0.3700000047683716, 0.3700000047683716,
  // 0.4000000059604645, 6.190000057220459, 6.230000019073486, 6.230000019073486,
  // 6.239999771118164, 6.25, 6.25, 6.25, 6.260000228881836, 6.269999980926514, 6.289999961853027,
  // 6.300000190734863, 4.190000057220459, 3.390000104904175, 3.3299999237060547,
  // 3.2899999618530273, 3.359999895095825, 3.309999942779541, 3.319999933242798,
  // 3.4100000858306885, 6.420000076293945, 6.429999828338623, 6.449999809265137,
  // 6.46999979019165, 6.480000019073486, 6.5, 6.53000020980835, 6.550000190734863,
  // 6.559999942779541, 6.579999923706055, 6.610000133514404, 6.630000114440918, 6.650000095367432,
  // 6.659999847412109, 6.690000057220459, 6.710000038146973, 6.75, 6.769999980926514,
  // 6.590000152587891, 6.570000171661377, 3.0799999237060547, 3.0299999713897705,
  // 2.9700000286102295, 2.940000057220459, 2.9100000858306885, 2.9100000858306885,
  // 2.940000057220459, 2.940000057220459, 7.159999847412109, 7.190000057220459, 7.21999979019165,
  // 7.25, 7.260000228881836, 7.210000038146973, 7.050000190734863, 6.909999847412109,
  // 6.789999961853027, 6.75, 6.789999961853027, 29.959999084472656, 4.070000171661377,
  // 4.050000190734863, 4.039999961853027, 3.990000009536743, 4.019999980926514, 4.019999980926514,
  // 3.6600000858306885, 3.509999990463257, 3.4700000286102295, 3.440000057220459,
  // 3.4200000762939453, 3.380000114440918, 3.4100000858306885, 3.430000066757202,
  // 8.3100004196167, 8.369999885559082, 8.449999809265137, 8.520000457763672, 8.600000381469727,
  // 8.680000305175781, 8.75, 8.84000015258789, 8.920000076293945, 9.0, 9.069999694824219,
  // 9.140000343322754, 9.210000038146973, 9.289999961853027, 5.21999979019165, 5.159999847412109,
  // 5.119999885559082, 5.079999923706055, 5.039999961853027, 5.0, 4.980000019073486,
  // 4.980000019073486, 5.019999980926514, 5.070000171661377, 5.110000133514404, 5.070000171661377,
  // 5.03000020980835, 5.039999961853027, 5.010000228881836, 8.649999618530273, 10.680000305175781,
  // 11.270000457763672, 5.409999847412109, 5.409999847412109, 8.59000015258789, 9.119999885559082,
  // 9.020000457763672, 9.0600004196167, 12.489999771118164, 12.670000076293945, 12.520000457763672,
  // 12.520000457763672, 13.460000038146973, 13.5, 13.380000114440918, 13.390000343322754,
  // 7.96999979019165, 7.989999771118164, 7.980000019073486, 15.119999885559082, 8.710000038146973,
  // 8.050000190734863, 7.920000076293945, 8.010000228881836, 8.40999984741211, 8.329999923706055,
  // 17.59000015258789, 15.520000457763672, 29.959999084472656, 15.4399995803833,
  // 15.380000114440918, 15.329999923706055, 15.279999732971191, 8.039999961853027,
  // 8.029999732971191, 8.050000190734863, 8.25, 8.59000015258789, 29.959999084472656,
  // 15.020000457763672, 14.989999771118164, 14.949999809265137, 14.9399995803833,
  // 14.90999984741211, 9.020000457763672, 9.029999732971191, 14.8100004196167, 14.8100004196167,
  // 14.760000228881836, 14.739999771118164, 14.720000267028809, 7.670000076293945,
  // 7.610000133514404, 7.610000133514404, 7.699999809265137, 7.800000190734863, 8.460000038146973,
  // 7.840000152587891, 7.639999866485596, 7.659999847412109, 7.670000076293945, 13.880000114440918,
  // 13.989999771118164, 14.010000228881836, 13.979999542236328, 14.050000190734863,
  // 14.020000457763672, 13.979999542236328, 14.09000015258789, 14.229999542236328,
  // 14.279999732971191, 14.279999732971191, 14.149999618530273, 14.1899995803833,
  // 14.569999694824219, 14.579999923706055, 14.600000381469727, 14.609999656677246,
  // 14.59000015258789, 14.609999656677246, 14.579999923706055, 14.170000076293945,
  // 14.1899995803833, 14.220000267028809, 4.110000133514404, 4.050000190734863, 4.010000228881836,
  // 3.990000009536743, 29.959999084472656, 14.800000190734863, 14.819999694824219,
  // 3.4600000381469727, 3.450000047683716, 3.440000057220459, 3.4200000762939453,
  // 3.4200000762939453, 3.309999942779541, 2.9000000953674316, 2.8499999046325684,
  // 2.880000114440918, 3.130000114440918, 3.440000057220459, 3.430000066757202, 3.430000066757202,
  // 3.4600000381469727, 3.490000009536743, 15.399999618530273, 15.399999618530273,
  // 15.479999542236328, 15.550000190734863, 15.600000381469727, 15.670000076293945,
  // 15.710000038146973, 15.739999771118164, 15.8100004196167, 8.130000114440918,
  // 8.220000267028809, 9.180000305175781, 9.149999618530273, 29.959999084472656,
  // 8.680000305175781, 2.490000009536743, 2.4800000190734863, 2.440000057220459,
  // 2.450000047683716, 2.450000047683716, 2.4700000286102295, 2.4600000381469727,
  // 2.4800000190734863, 2.490000009536743, 2.5, 2.5299999713897705, 2.549999952316284,
  // 2.559999942779541, 29.959999084472656, 29.959999084472656, 29.959999084472656,
  // 9.670000076293945, 29.959999084472656, 29.959999084472656, 11.34000015258789,
  // 11.1899995803833, 3.0199999809265137, 3.0299999713897705, 3.059999942779541,
  // 3.0199999809265137, 3.0199999809265137, 3.0399999618530273, 1.9500000476837158,
  // 1.809999942779541, 1.7400000095367432, 1.7300000190734863, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0}; std::vector<double> intensities = {0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 8192.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 8192.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 8192.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 8192.0, 0.0, 0.0, 0.0, 8192.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  // 0.0, 0.0, 0.0};

  //  std::vector<double> ranges = {0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 4.860000133514404, 4.820000171661377, 4.820000171661377, 4.840000152587891,
  //  5.260000228881836, 5.389999866485596, 5.25, 5.260000228881836, 5.559999942779541,
  //  5.610000133514404, 5.630000114440918, 5.590000152587891, 5.570000171661377,
  //  5.539999961853027, 5.510000228881836, 5.420000076293945, 5.369999885559082,
  //  5.329999923706055, 5.289999961853027, 5.21999979019165, 5.239999771118164, 5.289999961853027,
  //  5.349999904632568, 5.389999866485596, 5.460000038146973, 5.53000020980835, 5.639999866485596,
  //  5.699999809265137, 5.829999923706055, 5.949999809265137, 5.980000019073486,
  //  6.050000190734863, 7.28000020980835, 7.400000095367432, 7.510000228881836, 7.630000114440918,
  //  7.769999980926514, 7.889999866485596, 7.380000114440918, 7.039999961853027,
  //  6.869999885559082, 6.809999942779541, 6.829999923706055, 8.520000457763672,
  //  8.479999542236328, 8.489999771118164, 8.770000457763672, 6.730000019073486,
  //  6.690000057220459, 6.699999809265137, 6.760000228881836, 7.239999771118164,
  //  7.239999771118164, 7.260000228881836, 9.390000343322754, 11.5, 11.829999923706055,
  //  12.130000114440918, 12.489999771118164, 12.229999542236328, 12.239999771118164,
  //  13.1899995803833, 13.210000038146973, 13.229999542236328, 29.959999084472656,
  //  6.369999885559082, 6.349999904632568, 6.349999904632568, 6.480000019073486,
  //  6.869999885559082, 6.929999828338623, 18.350000381469727, 15.579999923706055,
  //  6.199999809265137, 6.190000057220459, 29.959999084472656, 4.46999979019165,
  //  4.440000057220459, 4.440000057220459, 4.429999828338623, 4.429999828338623,
  //  4.409999847412109, 4.409999847412109, 4.420000076293945, 4.409999847412109,
  //  4.409999847412109, 2.240000009536743, 2.2100000381469727, 2.2200000286102295,
  //  2.2100000381469727, 2.2200000286102295, 2.200000047683716, 2.2100000381469727,
  //  2.200000047683716, 2.200000047683716, 2.2200000286102295, 2.2300000190734863,
  //  2.2100000381469727, 2.240000009536743, 15.350000381469727, 15.380000114440918,
  //  15.369999885559082, 15.359999656677246, 15.390000343322754, 15.40999984741211,
  //  15.449999809265137, 15.430000305175781, 15.0, 6.940000057220459, 7.010000228881836,
  //  6.710000038146973, 29.959999084472656, 3.4200000762939453, 3.4000000953674316,
  //  3.369999885559082, 3.3299999237060547, 3.319999933242798, 3.3499999046325684,
  //  3.390000104904175, 3.440000057220459, 3.4800000190734863, 15.289999961853027,
  //  15.279999732971191, 15.390000343322754, 2.119999885559082, 2.119999885559082,
  //  2.130000114440918, 2.119999885559082, 2.069999933242798, 2.069999933242798,
  //  2.049999952316284, 2.049999952316284, 2.049999952316284, 2.069999933242798,
  //  2.109999895095825, 2.1700000762939453, 2.2200000286102295, 16.579999923706055,
  //  16.65999984741211, 29.959999084472656, 29.959999084472656, 29.959999084472656,
  //  29.959999084472656, 12.460000038146973, 29.959999084472656, 11.989999771118164,
  //  12.020000457763672, 29.959999084472656, 17.389999389648438, 17.450000762939453,
  //  12.09000015258789, 17.649999618530273, 17.739999771118164, 17.809999465942383,
  //  17.899999618530273, 17.729999542236328, 17.440000534057617, 17.229999542236328,
  //  17.06999969482422, 10.800000190734863, 9.25, 9.229999542236328, 9.260000228881836,
  //  6.010000228881836, 6.010000228881836, 0.6399999856948853,
  //  0.6399999856948853, 0.6200000047683716, 0.6100000143051147,
  //  0.6100000143051147, 0.6000000238418579, 0.6000000238418579,
  //  0.6100000143051147, 0.5899999737739563, 0.5899999737739563,
  //  0.5899999737739563, 0.6000000238418579, 0.6000000238418579,
  //  0.5799999833106995, 0.5899999737739563, 0.6000000238418579,
  //  0.6100000143051147, 0.6200000047683716, 0.6200000047683716,
  //  0.6100000143051147,
  //  0.6299999952316284, 29.959999084472656, 12.539999961853027, 5.199999809265137,
  //  5.21999979019165, 12.25, 12.170000076293945, 12.0600004196167, 11.979999542236328,
  //  11.890000343322754, 11.479999542236328, 11.4399995803833, 11.4399995803833,
  //  11.640000343322754, 11.710000038146973, 11.630000114440918, 11.569999694824219,
  //  11.5, 11.4399995803833, 11.34000015258789, 11.289999961853027, 11.210000038146973,
  //  11.149999618530273, 11.079999923706055, 11.020000457763672, 10.960000038146973,
  //  10.899999618530273, 10.850000381469727, 10.800000190734863, 6.679999828338623,
  //  6.699999809265137, 6.75, 7.320000171661377, 7.409999847412109, 7.449999809265137,
  //  10.470000267028809, 10.420000076293945, 10.369999885559082, 6.429999828338623,
  //  6.460000038146973, 6.489999771118164, 10.210000038146973, 10.180000305175781,
  //  10.130000114440918, 29.959999084472656, 7.059999942779541, 7.03000020980835,
  //  7.050000190734863, 9.960000038146973, 9.920000076293945, 9.869999885559082,
  //  9.390000343322754, 9.760000228881836, 9.850000381469727, 9.829999923706055,
  //  9.8100004196167, 9.760000228881836, 9.75, 9.729999542236328, 9.720000267028809,
  //  9.6899995803833, 9.65999984741211, 9.649999618530273, 9.630000114440918, 9.619999885559082,
  //  9.600000381469727, 9.579999923706055, 9.569999694824219, 9.5600004196167, 9.529999732971191,
  //  9.529999732971191, 9.510000228881836, 9.520000457763672, 9.489999771118164,
  //  9.5, 9.470000267028809, 9.470000267028809, 9.460000038146973, 9.4399995803833,
  //  9.369999885559082, 9.039999961853027, 2.140000104904175, 2.0999999046325684,
  //  2.069999933242798, 0.6899999976158142, 0.5199999809265137,
  //  0.4699999988079071, 0.4699999988079071, 0.4699999988079071,
  //  0.47999998927116394, 0.4699999988079071, 0.47999998927116394,
  //  0.49000000953674316, 0.47999998927116394, 0.49000000953674316,
  //  0.47999998927116394, 0.47999998927116394, 0.47999998927116394,
  //  0.4699999988079071, 0.49000000953674316, 0.47999998927116394,
  //  0.49000000953674316, 0.47999998927116394, 0.49000000953674316, 0.5, 0.5,
  //  0.5199999809265137,
  //  0.7799999713897705, 2.3299999237060547, 2.8399999141693115, 2.7200000286102295,
  //  0.6200000047683716, 0.5799999833106995, 0.5600000023841858,
  //  0.5400000214576721, 0.5299999713897705, 0.5199999809265137,
  //  0.5299999713897705, 0.5199999809265137, 0.5299999713897705,
  //  0.5299999713897705, 0.5400000214576721, 0.5299999713897705,
  //  0.5299999713897705, 0.5400000214576721, 0.5299999713897705,
  //  0.550000011920929, 0.5699999928474426, 0.5600000023841858,
  //  0.6200000047683716, 1.3700000047683716, 1.4199999570846558, 1.3899999856948853,
  //  1.3600000143051147, 1.3200000524520874, 1.2899999618530273, 1.2799999713897705,
  //  1.25, 1.2200000286102295, 1.190000057220459, 1.190000057220459, 1.149999976158142,
  //  1.1399999856948853, 1.1100000143051147, 1.100000023841858, 1.100000023841858,
  //  1.0499999523162842, 1.0499999523162842, 1.0299999713897705, 1.0299999713897705,
  //  1.0199999809265137, 0.9900000095367432, 0.9700000286102295,
  //  0.9599999785423279, 0.949999988079071, 0.9300000071525574,
  //  0.9200000166893005, 0.8999999761581421, 0.8999999761581421,
  //  0.8799999952316284, 0.8700000047683716, 0.8700000047683716,
  //  0.8500000238418579, 0.8500000238418579, 0.8399999737739563,
  //  0.8299999833106995, 0.8199999928474426, 0.8100000023841858,
  //  0.800000011920929, 0.7900000214576721, 0.7799999713897705,
  //  0.7900000214576721, 0.7900000214576721, 0.7900000214576721,
  //  0.7699999809265137, 0.7699999809265137, 0.75, 0.7599999904632568, 0.75,
  //  0.7400000095367432, 0.7400000095367432, 0.7200000286102295,
  //  0.7200000286102295, 0.7099999785423279, 0.6899999976158142,
  //  0.7099999785423279, 0.699999988079071, 0.6899999976158142,
  //  0.699999988079071, 0.6800000071525574, 0.6800000071525574,
  //  0.6700000166893005, 0.6700000166893005, 0.6700000166893005,
  //  0.6600000262260437, 0.6600000262260437, 0.6499999761581421,
  //  0.6399999856948853, 0.6399999856948853, 0.6499999761581421,
  //  0.6399999856948853, 0.6399999856948853, 0.6299999952316284,
  //  0.6299999952316284, 0.6200000047683716, 0.6200000047683716,
  //  0.6100000143051147, 0.6100000143051147, 0.6100000143051147,
  //  0.6000000238418579, 0.6000000238418579, 0.6000000238418579,
  //  0.6000000238418579, 0.5899999737739563, 0.6000000238418579,
  //  0.5899999737739563, 0.5799999833106995, 0.5899999737739563,
  //  0.5799999833106995, 0.5799999833106995, 0.5799999833106995,
  //  0.5799999833106995, 0.5799999833106995, 0.5600000023841858,
  //  0.5799999833106995, 0.5699999928474426, 0.5799999833106995,
  //  0.5699999928474426, 0.5699999928474426, 0.5600000023841858,
  //  0.5600000023841858, 0.550000011920929, 0.550000011920929,
  //  0.550000011920929, 0.550000011920929, 0.5400000214576721,
  //  0.550000011920929, 0.5400000214576721, 0.550000011920929,
  //  0.550000011920929, 0.550000011920929, 0.5600000023841858,
  //  0.550000011920929, 0.5400000214576721, 0.5400000214576721,
  //  0.550000011920929, 0.550000011920929, 0.550000011920929,
  //  0.5400000214576721, 0.5299999713897705, 0.5400000214576721,
  //  0.5400000214576721, 0.550000011920929, 0.5400000214576721,
  //  0.5299999713897705, 0.5299999713897705, 0.5299999713897705,
  //  0.5299999713897705, 0.5299999713897705, 0.5299999713897705,
  //  0.5299999713897705, 0.5400000214576721, 0.5400000214576721,
  //  0.5299999713897705, 0.5299999713897705, 0.5299999713897705,
  //  0.5299999713897705, 0.5299999713897705, 0.5299999713897705,
  //  0.5199999809265137, 0.5299999713897705, 0.5299999713897705,
  //  0.5299999713897705, 0.5299999713897705, 0.5299999713897705,
  //  0.5299999713897705, 0.5199999809265137, 0.5400000214576721,
  //  0.5299999713897705, 0.5400000214576721, 0.5400000214576721,
  //  0.5299999713897705, 0.5299999713897705, 0.5400000214576721,
  //  0.5400000214576721, 0.5400000214576721, 0.5400000214576721,
  //  0.5299999713897705, 0.5400000214576721, 0.5400000214576721,
  //  0.5400000214576721, 0.550000011920929, 0.5600000023841858,
  //  0.550000011920929, 0.5600000023841858, 0.5600000023841858,
  //  0.550000011920929, 0.550000011920929, 0.550000011920929,
  //  0.5400000214576721, 0.550000011920929, 0.550000011920929,
  //  0.550000011920929, 0.5600000023841858, 0.5600000023841858,
  //  0.5600000023841858, 0.5600000023841858, 0.5799999833106995,
  //  0.5899999737739563, 0.5799999833106995, 0.5799999833106995,
  //  0.5899999737739563, 0.5699999928474426, 0.5799999833106995,
  //  0.5799999833106995, 0.5799999833106995, 0.5799999833106995,
  //  0.5899999737739563, 0.5899999737739563, 0.5899999737739563,
  //  0.6000000238418579, 0.5899999737739563, 0.6000000238418579,
  //  0.6200000047683716, 0.6299999952316284, 0.6200000047683716,
  //  0.6100000143051147, 0.6100000143051147, 0.6200000047683716,
  //  0.6200000047683716, 0.6200000047683716, 0.6200000047683716,
  //  0.6299999952316284, 0.6299999952316284, 0.6399999856948853,
  //  0.6499999761581421, 0.6499999761581421, 0.6600000262260437,
  //  0.6600000262260437, 0.6600000262260437, 0.6700000166893005,
  //  0.6600000262260437, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0};
  //  std::vector<double> intensities = {0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  8192.0, 8192.0, 8192.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  8192.0, 8192.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 8192.0, 8192.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 8192.0, 0.0, 0.0, 8192.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 8192.0, 8192.0, 8192.0,
  //  8192.0, 8192.0, 8192.0, 8192.0, 8192.0, 8192.0, 8192.0, 8192.0, 8192.0,
  //  8192.0, 8192.0, 8192.0, 8192.0, 8192.0, 8192.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 8192.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 8192.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 8192.0, 8192.0, 8192.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  //  0.0, 0.0, 0.0, 0.0};

  std::vector<double> ranges = {0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.6600000262260437,
                                0.6700000166893005,
                                0.6600000262260437,
                                0.6600000262260437,
                                0.6600000262260437,
                                0.6600000262260437,
                                0.6499999761581421,
                                0.6399999856948853,
                                0.6399999856948853,
                                0.6100000143051147,
                                0.6399999856948853,
                                0.6299999952316284,
                                0.6200000047683716,
                                0.6100000143051147,
                                0.5899999737739563,
                                0.6000000238418579,
                                0.6000000238418579,
                                0.5899999737739563,
                                0.6000000238418579,
                                0.5899999737739563,
                                0.5899999737739563,
                                0.5799999833106995,
                                0.5799999833106995,
                                0.5600000023841858,
                                0.5600000023841858,
                                0.5600000023841858,
                                0.5699999928474426,
                                0.550000011920929,
                                0.5600000023841858,
                                0.550000011920929,
                                0.5600000023841858,
                                0.550000011920929,
                                0.5400000214576721,
                                0.5600000023841858,
                                0.5600000023841858,
                                0.550000011920929,
                                0.5400000214576721,
                                0.550000011920929,
                                0.5299999713897705,
                                0.5299999713897705,
                                0.5199999809265137,
                                0.5299999713897705,
                                0.5299999713897705,
                                0.5299999713897705,
                                0.5199999809265137,
                                0.5199999809265137,
                                0.5099999904632568,
                                0.5199999809265137,
                                0.5099999904632568,
                                0.5,
                                0.5,
                                0.5,
                                0.5,
                                0.5,
                                0.49000000953674316,
                                0.49000000953674316,
                                0.5,
                                0.5,
                                0.5,
                                0.5,
                                0.5,
                                0.5,
                                0.5,
                                0.47999998927116394,
                                0.49000000953674316,
                                0.47999998927116394,
                                0.49000000953674316,
                                0.47999998927116394,
                                0.47999998927116394,
                                0.47999998927116394,
                                0.47999998927116394,
                                0.47999998927116394,
                                0.49000000953674316,
                                0.47999998927116394,
                                0.47999998927116394,
                                0.47999998927116394,
                                0.47999998927116394,
                                0.49000000953674316,
                                0.47999998927116394,
                                0.47999998927116394,
                                0.4699999988079071,
                                0.4699999988079071,
                                0.4699999988079071,
                                0.4699999988079071,
                                0.47999998927116394,
                                0.4699999988079071,
                                0.4699999988079071,
                                0.4699999988079071,
                                0.47999998927116394,
                                0.47999998927116394,
                                0.4699999988079071,
                                0.47999998927116394,
                                0.4699999988079071,
                                0.4699999988079071,
                                0.4699999988079071,
                                0.47999998927116394,
                                0.47999998927116394,
                                0.47999998927116394,
                                0.47999998927116394,
                                0.4699999988079071,
                                0.47999998927116394,
                                0.47999998927116394,
                                0.4699999988079071,
                                0.4699999988079071,
                                0.47999998927116394,
                                0.4699999988079071,
                                0.47999998927116394,
                                0.47999998927116394,
                                0.47999998927116394,
                                0.4699999988079071,
                                0.49000000953674316,
                                0.47999998927116394,
                                0.47999998927116394,
                                0.5,
                                0.47999998927116394,
                                0.5,
                                0.49000000953674316,
                                0.5,
                                0.49000000953674316,
                                0.5,
                                0.5099999904632568,
                                0.49000000953674316,
                                0.5099999904632568,
                                0.5,
                                0.5,
                                0.49000000953674316,
                                0.5,
                                0.49000000953674316,
                                0.5099999904632568,
                                0.5,
                                0.5099999904632568,
                                0.5199999809265137,
                                0.5,
                                0.5,
                                0.5199999809265137,
                                0.5199999809265137,
                                0.5199999809265137,
                                0.5199999809265137,
                                0.5199999809265137,
                                0.5199999809265137,
                                0.5199999809265137,
                                0.5099999904632568,
                                0.5199999809265137,
                                0.5299999713897705,
                                0.5299999713897705,
                                0.5400000214576721,
                                0.5299999713897705,
                                0.550000011920929,
                                0.550000011920929,
                                0.5400000214576721,
                                0.550000011920929,
                                0.5600000023841858,
                                0.550000011920929,
                                0.550000011920929,
                                0.5600000023841858,
                                0.5699999928474426,
                                0.5600000023841858,
                                0.5699999928474426,
                                0.5799999833106995,
                                0.5799999833106995,
                                0.5799999833106995,
                                0.5899999737739563,
                                0.6100000143051147,
                                0.6000000238418579,
                                0.6100000143051147,
                                0.6299999952316284,
                                0.6100000143051147,
                                0.6200000047683716,
                                0.6299999952316284,
                                0.6399999856948853,
                                0.6299999952316284,
                                0.6499999761581421,
                                0.6200000047683716,
                                0.5400000214576721,
                                0.5199999809265137,
                                0.5299999713897705,
                                0.5299999713897705,
                                0.5099999904632568,
                                0.5099999904632568,
                                0.5,
                                0.5099999904632568,
                                0.5,
                                0.5099999904632568,
                                0.49000000953674316,
                                0.49000000953674316,
                                0.5,
                                0.5099999904632568,
                                0.5099999904632568,
                                0.49000000953674316,
                                0.5,
                                0.5,
                                0.5099999904632568,
                                0.5099999904632568,
                                0.5199999809265137,
                                0.5199999809265137,
                                0.5299999713897705,
                                0.5199999809265137,
                                0.5699999928474426,
                                0.7900000214576721,
                                0.8299999833106995,
                                0.8299999833106995,
                                0.8500000238418579,
                                0.8600000143051147,
                                0.8700000047683716,
                                0.8700000047683716,
                                0.9100000262260437,
                                0.8999999761581421,
                                0.9100000262260437,
                                0.9300000071525574,
                                0.9399999976158142,
                                0.949999988079071,
                                0.9700000286102295,
                                0.9800000190734863,
                                1.0099999904632568,
                                1.0199999809265137,
                                1.0399999618530273,
                                1.059999942779541,
                                1.0700000524520874,
                                1.100000023841858,
                                1.1100000143051147,
                                1.1299999952316284,
                                1.159999966621399,
                                1.1799999475479126,
                                1.2000000476837158,
                                1.2599999904632568,
                                3.130000114440918,
                                3.109999895095825,
                                3.0899999141693115,
                                3.0799999237060547,
                                3.069999933242798,
                                3.069999933242798,
                                3.059999942779541,
                                3.049999952316284,
                                3.0399999618530273,
                                3.0299999713897705,
                                3.0199999809265137,
                                3.009999990463257,
                                3.009999990463257,
                                3.0,
                                3.0,
                                2.9800000190734863,
                                2.9700000286102295,
                                2.9600000381469727,
                                2.9700000286102295,
                                2.950000047683716,
                                2.9700000286102295,
                                2.950000047683716,
                                2.930000066757202,
                                2.930000066757202,
                                2.940000057220459,
                                2.930000066757202,
                                2.930000066757202,
                                2.9200000762939453,
                                2.9100000858306885,
                                2.9100000858306885,
                                2.9100000858306885,
                                2.9000000953674316,
                                2.9000000953674316,
                                2.9000000953674316,
                                2.9000000953674316,
                                2.9000000953674316,
                                2.890000104904175,
                                2.890000104904175,
                                2.890000104904175,
                                2.890000104904175,
                                2.880000114440918,
                                2.880000114440918,
                                2.880000114440918,
                                2.9000000953674316,
                                2.890000104904175,
                                2.880000114440918,
                                2.869999885559082,
                                2.890000104904175,
                                2.880000114440918,
                                2.880000114440918,
                                2.880000114440918,
                                2.880000114440918,
                                2.9000000953674316,
                                2.880000114440918,
                                2.890000104904175,
                                2.890000104904175,
                                2.890000104904175,
                                2.869999885559082,
                                2.7899999618530273,
                                2.640000104904175,
                                2.619999885559082,
                                2.5999999046325684,
                                2.5999999046325684,
                                2.5999999046325684,
                                2.630000114440918,
                                2.799999952316284,
                                2.8399999141693115,
                                2.8499999046325684,
                                2.859999895095825,
                                2.859999895095825,
                                2.859999895095825,
                                2.880000114440918,
                                2.869999885559082,
                                2.880000114440918,
                                2.890000104904175,
                                2.9000000953674316,
                                2.9000000953674316,
                                2.9100000858306885,
                                2.9200000762939453,
                                2.9200000762939453,
                                2.9200000762939453,
                                2.940000057220459,
                                2.940000057220459,
                                2.950000047683716,
                                2.9600000381469727,
                                2.9600000381469727,
                                2.9700000286102295,
                                2.9700000286102295,
                                2.990000009536743,
                                3.009999990463257,
                                3.009999990463257,
                                3.0199999809265137,
                                3.0399999618530273,
                                3.049999952316284,
                                3.059999942779541,
                                3.059999942779541,
                                3.0799999237060547,
                                3.0899999141693115,
                                3.0999999046325684,
                                3.119999885559082,
                                3.119999885559082,
                                3.140000104904175,
                                3.1600000858306885,
                                3.1700000762939453,
                                3.190000057220459,
                                3.2100000381469727,
                                3.2200000286102295,
                                3.240000009536743,
                                3.259999990463257,
                                3.2699999809265137,
                                3.299999952316284,
                                3.319999933242798,
                                3.3299999237060547,
                                3.359999895095825,
                                3.369999885559082,
                                3.4100000858306885,
                                3.4100000858306885,
                                3.440000057220459,
                                3.4700000286102295,
                                3.4800000190734863,
                                3.509999990463257,
                                3.5399999618530273,
                                3.559999942779541,
                                3.5899999141693115,
                                3.619999885559082,
                                3.630000114440918,
                                3.6700000762939453,
                                3.700000047683716,
                                3.7300000190734863,
                                3.75,
                                3.7699999809265137,
                                3.819999933242798,
                                3.8499999046325684,
                                3.890000104904175,
                                3.9200000762939453,
                                3.950000047683716,
                                3.990000009536743,
                                4.019999980926514,
                                0.6499999761581421,
                                0.6700000166893005,
                                0.6399999856948853,
                                0.6399999856948853,
                                0.6399999856948853,
                                0.6299999952316284,
                                0.6299999952316284,
                                0.6299999952316284,
                                0.6299999952316284,
                                0.6100000143051147,
                                0.6100000143051147,
                                0.6200000047683716,
                                0.6100000143051147,
                                0.6100000143051147,
                                0.6100000143051147,
                                0.6200000047683716,
                                0.6100000143051147,
                                0.6200000047683716,
                                0.6200000047683716,
                                0.6299999952316284,
                                0.6399999856948853,
                                0.6499999761581421,
                                0.6399999856948853,
                                0.6600000262260437,
                                5.130000114440918,
                                5.099999904632568,
                                5.03000020980835,
                                4.980000019073486,
                                4.949999809265137,
                                4.920000076293945,
                                4.880000114440918,
                                4.820000171661377,
                                4.820000171661377,
                                4.869999885559082,
                                4.960000038146973,
                                5.019999980926514,
                                5.159999847412109,
                                5.300000190734863,
                                5.420000076293945,
                                5.489999771118164,
                                5.480000019073486,
                                5.519999980926514,
                                5.539999961853027,
                                7.400000095367432,
                                7.570000171661377,
                                7.760000228881836,
                                7.949999809265137,
                                6.619999885559082,
                                6.619999885559082,
                                6.579999923706055,
                                6.739999771118164,
                                6.880000114440918,
                                8.25,
                                8.489999771118164,
                                8.470000267028809,
                                7.710000038146973,
                                6.760000228881836,
                                0.6100000143051147,
                                0.6000000238418579,
                                0.5799999833106995,
                                0.5799999833106995,
                                0.5699999928474426,
                                0.5699999928474426,
                                0.5799999833106995,
                                0.550000011920929,
                                0.5600000023841858,
                                0.5600000023841858,
                                0.550000011920929,
                                0.550000011920929,
                                0.550000011920929,
                                0.5299999713897705,
                                0.5400000214576721,
                                0.5400000214576721,
                                0.5299999713897705,
                                0.5299999713897705,
                                0.5400000214576721,
                                0.5299999713897705,
                                0.5299999713897705,
                                0.5199999809265137,
                                0.5299999713897705,
                                0.5299999713897705,
                                0.5099999904632568,
                                0.5199999809265137,
                                0.5199999809265137,
                                0.5299999713897705,
                                0.5099999904632568,
                                0.5,
                                0.5199999809265137,
                                0.5199999809265137,
                                0.5,
                                0.5,
                                0.5,
                                0.5099999904632568,
                                0.5199999809265137,
                                0.5199999809265137,
                                0.5099999904632568,
                                0.5299999713897705,
                                0.5199999809265137,
                                0.5299999713897705,
                                29.959999084472656,
                                4.46999979019165,
                                4.46999979019165,
                                4.489999771118164,
                                4.579999923706055,
                                4.940000057220459,
                                4.929999828338623,
                                4.539999961853027,
                                4.559999942779541,
                                4.590000152587891,
                                4.599999904632568,
                                4.610000133514404,
                                3.380000114440918,
                                3.2300000190734863,
                                3.2300000190734863,
                                3.2300000190734863,
                                3.2300000190734863,
                                3.2300000190734863,
                                3.240000009536743,
                                3.25,
                                3.259999990463257,
                                3.2699999809265137,
                                2.630000114440918,
                                2.390000104904175,
                                2.380000114440918,
                                2.390000104904175,
                                2.4000000953674316,
                                2.4000000953674316,
                                2.390000104904175,
                                2.4000000953674316,
                                2.4000000953674316,
                                2.4200000762939453,
                                2.440000057220459,
                                2.4600000381469727,
                                2.619999885559082,
                                3.680000066757202,
                                3.6700000762939453,
                                3.6500000953674316,
                                3.640000104904175,
                                3.690000057220459,
                                3.759999990463257,
                                3.859999895095825,
                                5.059999942779541,
                                5.090000152587891,
                                5.090000152587891,
                                5.130000114440918,
                                5.150000095367432,
                                5.170000076293945,
                                5.199999809265137,
                                5.21999979019165,
                                5.25,
                                5.300000190734863,
                                5.320000171661377,
                                5.340000152587891,
                                5.369999885559082,
                                5.389999866485596,
                                5.420000076293945,
                                2.559999942779541,
                                2.559999942779541,
                                2.559999942779541,
                                2.5399999618530273,
                                2.5399999618530273,
                                2.5399999618530273,
                                2.5199999809265137,
                                2.5299999713897705,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0};
  std::vector<double> intensities = {
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    8192.0, 8192.0, 8192.0, 8192.0, 8192.0,
      8192.0, 8192.0, 8192.0, 8192.0, 8192.0, 8192.0, 8192.0, 8192.0, 8192.0,
      8192.0, 8192.0, 0.0,    8192.0, 0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    8192.0, 8192.0, 8192.0, 8192.0, 0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    8192.0, 8192.0, 8192.0, 8192.0, 8192.0, 8192.0, 8192.0,
      8192.0, 8192.0, 8192.0, 8192.0, 8192.0, 8192.0, 8192.0, 8192.0, 8192.0,
      8192.0, 8192.0, 8192.0, 8192.0, 0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    8192.0, 8192.0, 0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    8192.0, 0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
      0.0};

  sensor::PointCloud unperturbed_point_cloud;
  for (size_t i = 0; i < ranges.size(); ++i) {
    const float angle = i * 0.00872664619237f;
    const float x = std::cos(angle);
    const float y = std::sin(angle);
    const Eigen::Vector2f end = Eigen::Vector2f{x, y} * ranges[i];
    unperturbed_point_cloud.push_back(
        {{end.x(), end.y(), 0.f}, static_cast<float>(intensities[i])});
  }

  const float resolution = 0.01f;
  const float side_length = 20.0f;
  const int cells = side_length / resolution;

  ValueConversionTables conversion_tables;

  ProbabilityGrid probability_grid(
      MapLimits(resolution, Eigen::Vector2d(side_length, side_length),
                CellLimits(cells, cells)),
      &conversion_tables);

  transform::Rigid2f inserted_pose({side_length / 2.0f, side_length / 2.0f},
                                   0.0);
  auto actual_tpc = sensor::TransformPointCloud(
      unperturbed_point_cloud, transform::Embed3D(inserted_pose.cast<float>()));

  const std::vector<Circle<float>> circles =
      DetectReflectivePoles(unperturbed_point_cloud, 0.060f);

  auto surface = probability_grid.DrawSurface();
  cairo_t* cr = cairo_create(surface.get());

  cairo_set_source_rgba(cr, 1, 1, 1, 1);
  cairo_set_line_width(cr, 2.0);
  const auto mp =
      probability_grid.limits().GetCellIndex(inserted_pose.translation());
  cairo_arc(cr, mp.x(), mp.y(), 10.0, 0, 2 * M_PI);
  cairo_stroke(cr);

  for (const auto& point : actual_tpc) {
    cairo_set_source_rgba(cr, 0, 0, 1, 1);
    cairo_set_line_width(cr, 8.0);
    const auto mp = probability_grid.limits().GetCellIndex(
        {point.position.x(), point.position.y()});
    cairo_arc(cr, mp.x(), mp.y(), 1.0, 0, 2 * M_PI);
    cairo_fill(cr);
    cairo_stroke(cr);
  }

  //  std::vector<Circle<float>> opt;
  //  for (const auto& c : circles) {
  //    opt.push_back(FitCircle(c));
  //  }

  for (const auto& c : circles) {
    LOG(INFO) << "Circle: n: " << c.count << " mse: " << c.mse << std::endl;

    cairo_set_source_rgba(cr, 1, 1, 0, 0.1);
    cairo_set_line_width(cr, 2.0);
    const auto tr = inserted_pose * c.position;
    const auto mp = probability_grid.limits().GetCellIndex(tr);
    cairo_arc(cr, mp.x(), mp.y(), c.radius / resolution, 0, 2 * M_PI);
    cairo_stroke(cr);

    for (const auto p : c.points) {
      cairo_set_source_rgba(cr, 1, 1, 1, 1);
      cairo_set_line_width(cr, 1.0);
      const auto tr = inserted_pose * p;
      const auto mp = probability_grid.limits().GetCellIndex(tr);
      cairo_rectangle(cr, mp.x(), mp.y(), 1, 1);
      cairo_fill(cr);
    }
  }

  //  for (const auto& c : opt) {
  //    if (c.mse > 1e-4) continue;

  //    cairo_set_source_rgba(cr, 0.2, 1, 0.2, 1.0);
  //    cairo_set_line_width(cr, 2.0);
  //    const auto tr = inserted_pose * c.position;
  //    const auto mp = probability_grid.limits().GetCellIndex(tr);
  //    cairo_arc(cr, mp.x(), mp.y(), c.radius / resolution, 0, 2 * M_PI);
  //    cairo_stroke(cr);
  //  }

  cairo_destroy(cr);
  cairo_surface_write_to_png(surface.get(), "test.png");
}

TEST(CirclDetector, test_hough) {
  const float resolution = 0.01;
  const float side_length = 20.0;
  const int cells = side_length / resolution;

  ValueConversionTables conversion_tables;

  ProbabilityGrid probability_grid(
      MapLimits(resolution, Eigen::Vector2d(side_length, side_length),
                CellLimits(cells, cells)),
      &conversion_tables);

  for (int jj = 0; jj < cells; ++jj) {
    for (int ii = 0; ii < cells / 8.0; ++ii) {
      if (ii < jj) {
      } else if (ii == jj) {
        probability_grid.SetProbability({ii + 1, jj}, 1.0);
        probability_grid.SetProbability({ii, jj}, 1.0);
      } else
        probability_grid.SetProbability({ii, jj}, 0.1);
    }
  }
  probability_grid.FinishUpdate();

  // insert some random retro reflective poles
  std::mt19937 prng(42);
  std::uniform_int_distribution<int> pole_dist;
  using param_t = std::uniform_int_distribution<>::param_type;
  for (int ii = 0; ii < 60; ++ii) {
    const int pole_size = static_cast<int>(0.07f / resolution);
    const int pole_x = pole_dist(prng, param_t(0, cells));
    const int pole_y = pole_dist(prng, param_t(0, cells));

    const float prob = 1.0;
    const double r2 =
        static_cast<double>(pole_size) * static_cast<double>(pole_size);

    for (int jj = pole_y - pole_size; jj <= pole_y + pole_size; ++jj) {
      if (jj >= cells || jj < 0) break;

      for (int ii = pole_x - pole_size; ii <= pole_x + pole_size; ++ii) {
        if (ii >= cells || ii < 0) break;

        const double w = static_cast<double>(ii - pole_x);
        const double h = static_cast<double>(jj - pole_y);
        const double _r2 = w * w + h * h;
        if (std::abs(_r2 - r2) <= 1) {
          probability_grid.SetProbability({ii, jj}, prob);
        }
      }
    }
    probability_grid.FinishUpdate();
  }

  LOG(INFO) << "build grid";

  const auto circles = DetectCircles(probability_grid, 0.07f);

  auto surface = probability_grid.DrawSurface();
  cairo_t* cr = cairo_create(surface.get());

  scan_matching::proto::CeresScanMatcherOptions2D options;
  options.set_occupied_space_weight(1.0);
  options.set_translation_weight(1.0);
  options.set_rotation_weight(1.0);
  options.mutable_ceres_solver_options()->set_max_num_iterations(20);
  options.mutable_ceres_solver_options()->set_num_threads(1);
  scan_matching::CeresScanMatcher2D scan_matcher(options);

  for (const auto& c : circles) {
    cairo_set_source_rgba(cr, 1, 1, 0, 1.0);
    cairo_set_line_width(cr, 1.0);
    cairo_arc(cr, c.x(), c.y(), 1, 0, 2 * M_PI);
    cairo_stroke(cr);
  }

  cairo_destroy(cr);

  cairo_surface_write_to_png(surface.get(), "test2.png");
}

}  // namespace
}  // namespace mapping
}  // namespace cartographer
